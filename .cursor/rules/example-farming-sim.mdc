---

id: global-store-example-farming-sim
title: Global Store â€“ Example: Farming Sim
version: 0.2.2
category: phaser-plugin
status: active
--------------

## ğŸŒ¾ Farming Sim â€“ Example Usage

This example demonstrates how to organize a persistent global state for a life sim or farming game, inspired by Stardew Valley, Animal Crossing, and My Time at Sandrock.

It includes crop fields, NPC relationships, crafting systems, daily resets, animals, and home upgrades.

---

### ğŸ§  Recommended Key Structure

```ts
// ğŸ—“ Calendar & Seasons
calendar.day = 15;
calendar.season = 'summer';
calendar.year = 2;

// ğŸŒ± Field (tile-based, object array)
fields = [
  { x: 1, y: 2, crop: 'wheat', stage: 2, watered: true },
  { x: 2, y: 3, crop: 'carrot', stage: 1, watered: false }
];

// ğŸŒ¦ï¸ Weather (stored, not generated here)
world.weather = 'rainy';

// ğŸ§‘ Player State
player.stamina = 92;
player.appearance = { hair: 'braids', clothes: 'overalls' };
player.checkpoint = 'farm';

// ğŸ  House
home.level = 2;
home.furniture = [
  { id: 'bed', x: 2, y: 4 },
  { id: 'dresser', x: 1, y: 3 }
];

// ğŸ§° Inventory
inventory.wood = 35;
inventory.stone = 20;
inventory.seeds = { carrot: 3, wheat: 5 };

// ğŸ”¨ Crafting Queues
crafting.workbench1 = { item: 'scarecrow', remainingTime: 45 };
crafting.kitchen = null;

// ğŸ„ Animals
animals = [
  { id: 'cow01', name: 'Bessie', fed: true, happy: true },
  { id: 'chicken01', name: 'Peep', fed: false, happy: false }
];

// ğŸ¤ Relationships
npcs.alex = {
  hearts: 4,
  giftedToday: true,
  married: false
};
npcs.mayor = {
  hearts: 2,
  giftedToday: false
};

// ğŸ Festival Flags
flags.event.springFestival = true;
flags.event.eggHunt = false;

// âœ‰ï¸ Mail
inbox = [
  { id: 'letter1', read: true },
  { id: 'letter2', read: false }
];
```

---

### ğŸ›  Code Examples

#### âœ… Watering a Crop (Atomic replacement)

```ts
const updated = fields.map(tile =>
  tile.x === 2 && tile.y === 3 ? { ...tile, watered: true } : tile
);
globalStore.set('fields', updated);
```

#### ğŸ§¡ Increasing Affection

```ts
const npc = globalStore.get('npcs.alex');
globalStore.set('npcs.alex', {
  ...npc,
  hearts: npc.hearts + 1,
  giftedToday: true
});
```

#### ğŸ„ Feeding Animals

```ts
const animals = globalStore.get('animals');
const fed = animals.map(a => ({ ...a, fed: true }));
globalStore.set('animals', fed);
```

#### ğŸ” Daily Reset Pattern

```ts
// Reset daily flags (giftedToday, watered, etc.)
const npcs = globalStore.get('npcs');
for (const name in npcs) {
  npcs[name].giftedToday = false;
}
globalStore.set('npcs', npcs);
```

---

### ğŸ’¡ Design Tips

* Avoid deeply nested per-tile trees â€” use arrays of objects for crops, animals, and furniture.
* Use `onChange()` for things like crafting completion, festival triggers, or relationship changes.
* Daily reset logic is a great candidate for scene boot hooks or day-end transitions.
* Keep weather/event logic external, but store results globally.

---

### âœ… Plugin Alignment Table

| Rule                        | Coverage                                                      |
| --------------------------- | ------------------------------------------------------------- |
| **Namespaced Keys**         | âœ… `player`, `fields`, `crafting`, `npcs`                      |
| **Object Arrays**           | âœ… `fields[]`, `animals[]`, `furniture[]`                      |
| **Booleans, timers, flags** | âœ… `giftedToday`, `fed`, `weather`, `remainingTime`            |
| **Atomic update examples**  | âœ… Required to trigger `onChange()`                            |
| **Realistic usage**         | âœ… Pulls from actual patterns seen in Stardew, Animal Crossing |

---

### ğŸ”— See Also

* `usage.mdc` for API details
* `anti-patterns.mdc` for common misuse cases
* `todo.mdc` to track future documentation like fishing, journal, or multiplayer state
