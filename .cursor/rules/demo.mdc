---
description: 
globs: 
alwaysApply: false
---
---
id: global-store-demo
title: Global Store â€“ Demo Plan
version: 0.2.1
category: phaser-plugin
status: active
---

## ğŸ§ª Demo Title: â€œThe Camp and the Shrineâ€

A minimal RPG shell that simulates a persistent player + world state using `global-store`.

---

## ğŸ® Scenes

### ğŸ”¥ Campfire

- Shows current:
  - `player.name`
  - `player.hp`
  - `player.inventory`
  - `settings.audio.muted`
- Buttons:
  - â€œChange Nameâ€ â†’ Prompts and stores to `player.name`
  - â€œSleep to Restore HPâ€ â†’ Sets `player.hp = 100`
  - â€œToggle Audioâ€ â†’ Sets `settings.audio.muted`
  - â€œEnter Shrineâ€ â†’ Starts next scene

---

### ğŸ› Shrine Interior

- Simulates:
  - Combat (enemy attacks reduce `player.hp` every 2s)
  - UI reacts via `onChange('player.hp')`
- Shows:
  - If player has `old_key`, they can unlock door
  - Sets `world.shrine.secretRoomUnlocked = true`
- Button:
  - â€œReturn to Campâ€ â†’ Loads Campfire scene

---

### ğŸŒŒ Shrine Secret Room

- Entry only allowed if `world.shrine.secretRoomUnlocked === true`
- Shows:
  - Final `globalStore.dump()` (live or snapshot)
- Reward:
  - Adds `"amulet"` to `player.inventory`

---

## ğŸ§° Debug Overlay (Optional, Toggleable)

- Shows:
  - Live store dump
  - Visual console log of triggered `onChange()` events
    - Example: `[onChange] player.hp = 90 â†’ 85`

Note: The debug overlay is only included in the demo project.
It is not bundled into the global-store plugin, and will not be included in production builds.

---

## ğŸ¯ Edge Cases Covered

- Nested keys: `player.stats.hp`, `world.shrine.secretRoomUnlocked`
- Arrays and deep objects: `player.inventory`
- Boolean toggles: `settings.audio.muted`
- Listener lifecycle: `onChange()` in `create()`, `offChange()` in `shutdown()`
- Simulated save/load: `globalStore.reset(...)` used for â€œNew Gameâ€ or test

---

